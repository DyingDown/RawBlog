---
title: 计算机网络-网络层
date: 2020-04-29 08:34:01
tags: Knowledge points
categories: Computer Network
postImage: https://s1.ax1x.com/2020/04/30/JH4NZ9.jpg
---

## 网络层提供的两种服务

### 网际协议IP

### 虚拟互联网

### IP地址

### IP地址与硬件地址

### IP数据报格式

#### ARP & RARP

![img](https://s1.ax1x.com/2020/04/29/J7Cjud.png)

#### IP数据报

一个IP数据报由首部和数据两部分组成

- 首部的前一部分是固定长度,共20字节,是所有IP数据报必须句有的.
- 在首部的固定部分的垢面是一些可选字段,其长度是可变的

![img](https://s1.ax1x.com/2020/04/29/J7kOit.png)

![img](https://s1.ax1x.com/2020/04/29/J7ADYt.png)

- 版本——占4位，指IP协议的版本
- 首部长度——占4位，可表示的最大数值是15个单位（一个单位为4字节），因此IP的首部长度的最大值是60字节。
- 区分服务——占8位，用来获得更好的服务，在旧标准中叫做服务类型，但实际上一直未被使用过。1998年这个字段改名为区分服务，只有在使用区分服务（Diff Serve）时这个字段才起作用。在一般的情况下都不使用这个字段$Q_0S$服务质量
- 总长度——占16位，指首部和数据之和的长度，单位为字节，因此数据报的对打长度为65535字节。总长度必须不超过最大传送单元MTU。
- 标识（identification）——占16位，是一个计数器，用来产生数据报的表示，不是序号，每产生一个数据报，就增加1。
- 标志（flag）——占3位，目前只有前两位有意义。标志字段的最低为是MF（More Fragment）。MF=1表示后面“还有分片”。MF=0表示最后一个分片。标志字段中间的一位是DF（Don’t Fragment）。只有当DF=0时才允许分片。
- 片偏移——13位。指出，较长的分组在分片后，某片在原分组中的相对位置。片偏移以8个字节为偏移单位。
- 生存时间——8位，几位TTL（Time To Live）数据报在网络中可通过的路由器数的最大值。（防止数据包在路由器之间形成死循环永远到不了目的地）
- 协议——8位。指出此数据报携带的数据使用何种协议以便主机的IP层将数据部分上交给哪个处理过程。
- 首部校验和——16位，只检验数据报的首部不检验数据部分。不采用CRC而采用简单的计算方法。
- 源地址和目的地址——4字节。
- 可变部分
  IP首部的可变部分就是一个选项字段，用来支持排错、测量以及安全等措施，内容很丰富。
  选项字段的长度可变，从1个字节到40个字节不等，取决于所选择的项目。
  增加首部的可变部分是为了增加IP数据报的功能，但这同时也使得IP数据报的首部长度成为可变的。这就增加了每一个路由器处理数据报的开销。实际上这些选项很少被使用。

IP数据报首部的固定部分中的各字段

![img](https://s1.ax1x.com/2020/04/29/J7171H.png)

数据报分片举例

![img](https://s1.ax1x.com/2020/04/29/J7mGrT.png)

首部校验方法

![img](https://s1.ax1x.com/2020/04/29/J7liGQ.png)

#### 数据报的格式

数据路由：路由器在不同网段转发数据包

网络畅通条件：能去能回

沿途的路由器必须知道到目标网络下一跳给哪个接口
沿途的路由器必须知道到源网络下一跳给哪个接口

![img](https://s1.ax1x.com/2020/04/29/J7GEfU.png)

```
Router1>en
Router1#config t
Router1#show ip route
Router1#config t
Router1#(config)#ip route 193.168.0.0 255.255.55.0 172.16.0.1
Router1#^Z
Router1#
Router1#show ip route
Router1#
Router1#config t
Router1#(config)#no ip route 192.168.0.0 255.255.255.0 172.16.0.1
```

### IP转发和分组的流程

### 划分子网和构造超网

### 网际控制报文协议 ICMP

### 因特网的路由选择协议

### IP多播

### 虚拟专用网 VPN 和网络地址转换 NAT