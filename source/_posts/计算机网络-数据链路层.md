---
title: 计算机网络-数据链路层
date: 2020-04-27 06:09:07
tags: Knowledge points
categories: Computer Network
postImage: https://s1.ax1x.com/2020/04/27/JWwws1.jpg
---

学习计算机网络这门课，由于是网络视频授课，效果不佳，容易忘记，便总结课堂笔记。

<!--more-->

## 数据链路层基本概念

数据发送模型

![img](https://s1.ax1x.com/2020/04/27/Jf8Ek9.png)

![img](https://s1.ax1x.com/2020/04/27/Jf8U6f.png)

![img](https://s1.ax1x.com/2020/04/27/JfJ1JA.png)数据链路层使用的信道主要有以下两种类型:
**点对点信道**：这种信道使用一对一的点对点通信方式。
**广播信道**：这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。

### 链路与数据链路

**链路(link)**是一条点到点的物理线路段，中间没有其他任何的点。

- 一条链路只是一条通路的一个组成部分

**数据链路(data link)** 除了我物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

- 现在最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件
- 一半的适配器都包括了数据链路层和物理层这两层的功能。

### 帧

![img](https://s1.ax1x.com/2020/04/27/JhGUfA.png)

## 数据链路层基本问题

### 封装成帧

- 封装成帧(framing)就是再一段数据前后分别添加首部和尾部，然后就封装成一个帧。确定帧的界限。
- 首部和尾部的一个重要作用就是进行帧界定

![img](file:///C:/Users/o_oyao/AppData/Roaming/Typora/typora-user-images/image-20200427220633700.png)

![img](https://s1.ax1x.com/2020/04/27/JhYHzR.png)

### 透明传输

若传输的数据是ASCII码中“可打印字符（共95个）”集时，若传输的数据不仅是由“可打印字符”组成是，就会出现问题。

![img](https://s1.ax1x.com/2020/04/28/JhzC6K.png)

用字节填充法解决同名传输问题

发送端发送的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符字符”ESC“（其16进制编码是 18）。

**字节填充**（byte stuffing）或**字符填充**（character Stuffing）——接收端的数据链路层在将数据发送网络层之前插入删除的**转义字符**。

如果转义字符也出现在数据当中，那么应在转义字符前插入一个转义字符，当接收端接收到连续的两个转义字符时，就删除其中前面的一个。

![img](https://s1.ax1x.com/2020/04/28/JhzD74.png)

### 差错控制

传输过程中可能会产生**比特差错**：1可能会变成0而0也可能变成
在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率BER (Bit Error Rate)。
误码率与信噪比有很大的关系。
为了保证数据传输的可靠性，在算机网络传 输数据时，必须采用各种差错检测措施。

循环冗余检验（CRC校验）来纠错。

## 两种情况下的数据链路层

### 点到点信道的数据链路层

PPP协议

现在全世界使用的最多的数据链路层协议是**点对点协议** （Point-to-Point Protocol）。

用户使用拨号电话线接入因特网时，一般都是使用PPP协议。

PPP协议使用场合

![img](https://s1.ax1x.com/2020/04/28/J49TN4.png)

PPP协议帧格式

![img](https://s1.ax1x.com/2020/04/28/J4CgaD.png)

字节填充

- 将信息字段中出现的每一个 0x7E 字节转变为2字节序列（0x7D，0x5E)。
- 若信息字段中出现一个0x7D的字节，则将其转换为2字节序列（0x7D，0x5D)。
- 若信息字段中出现ASCII码的控制字符（即数值小与0x20的字符），则在该字符前面加入一个0x7D字节，同时将该字符的编码加以改变。

![img](https://s1.ax1x.com/2020/04/28/J4P1Fe.png)

零比特填充法

![img](https://s1.ax1x.com/2020/04/28/J4i91A.png)

![img](https://s1.ax1x.com/2020/04/28/J5z69s.png)

### 广播信道的数据链路层

![img](https://s1.ax1x.com/2020/04/28/JIUs3D.png)

#### 局域网的特点和优点

局域网最主要的特点是:网络为一个单位所拥有，且地理范围积和站点数目均有限。
局域网具有如下的一些主要优点:

- 具有**广播功能**，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
- 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
- 提高了系统的可靠性、可用性和生存性。

#### 共享通信媒体

静态划分信道

- 频分复用
- 时分复用
- 波分复用
- 码分复用

动态媒体接入控制(多点接入)

- 随机接入（主要被以太网用）
- 受控接入，如多点线路探寻（polling），或轮询。（目前已不被采用）

#### 认识以太网

![img](https://s1.ax1x.com/2020/04/28/JIBym4.png)

![img](https://s1.ax1x.com/2020/04/28/JIB56O.png)

#### 以太网协议 CSMA/CD协议

载波接听多点接入/碰撞检测

CSMA/CD表示Carrier Sense Multiple Access with Collision Detection。

“**多点接入**”表示许多计算机以多点接入的方式连接在一根总线上。
“**载波监听**”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。

“载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。

#### 冲突检测

“碰撞检测”就是计算机边发送数据边检测信道上的信号电压大小。

- 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大(互相叠加)

- 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。
- 所谓“碰撞”就是发生了冲突、因此“碰撞检测”也称为“**冲突检测**”。

**检测到碰撞后**

- 在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来。
- 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送。

![img](https://s1.ax1x.com/2020/04/28/JIgejx.png)

重要特性

使用CSMA/CD 协议的以太网不能进行全双工通信而只能进行双交替通信(半双工通信)。
每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。这种**发送的不确定性**使整个以太网的平均通信量远小于以太网的最高数据率。

争用期

最先发送数据帧的站，在发送数据帧后至多经过时间2τ ( 两倍的端端返时延)就可知道发送的数据帧是否遭受了碰撞。

经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。以太网的争用期

- 以太网的端到端往返时延2τ称为争用期，或碰撞窗口。通常，取51.2μs51.2��为争用期的长度。

- 对于10 Mb/s以太网，在争用期内可发送512 bit,即64字节。

- 以太网在发送数据时，若前84字节未发生冲突，则后续的数据就不会发生冲突。

最短有效帧长

- 如果发生冲突，就一定是在发送的前64字节之内。.
- 由于一检测到冲突就立即中止发送，这时已经发送出去的数据一定小于64字节。

- 以太网规定了最短有效帧长为64字节，凡长度小于64字节的帧都是由于冲突而异常中止的无效帧。

二进制指数类型退避算法

发生碰撞的站在停止发送数据后，要推迟(退避) 一个随机时间才能再发送数据。

- 确定基本退避时间，一般是取为争用期2τ。
- 定义参数k，k= Min[重传次数，10]
- 从整数集合[0,1..，(2k−1)][0,1..，(2�−1)]中随机地取出一个数，记为r。重传所需的时延就是r倍的基本退避时间。
- 当重传达16次仍不能成功时即丢弃该帧，并向高层报告。

## 以太局域网（以太网）

### 以太网两个标准

- DIX Ethernet V2是世界上第一一个局域网产品(以太网)的规约。
- IEEE的802.3标准。
  DIX Ethernet V2标准与IEEE 的802. 3标准只有很小的差别,因此可以将802. 3局域网简称为“**以太网**”。
  严格说来，“以太网” 应当是指符合DIX Ethernet V2标准的局域网

### 以太网与数据链路层两个子层

为了使数据链路层能更好地适应多种局域网标准，802委员会就将域网的数据链路层拆成两个子层:

- 逻辑链路控制LLC (Logical Link Control)子层
- 媒体接入控制**MAC** (Medium Access Control)子层。

与接入到传输媒体有关的内容都放在MAC子层，而LLC子层则与传输媒体无关，不管采用何种协议的局域网对LLC子层来说都是透明的 。

由于TCP/IP体系经常使用的局域网是DIX Ethernet V2而不是802.3标准中的几种局域网，因此现在802委员会制定的逻辑链路控制子层LLC (即802. 2标准)的作用已经不大了。

很多厂商生产的适配器上就仅装有MAC协议而没有LLC协议。

### 星型拓扑

传统以太网最初是使用粗同轴电缆，后来演进到使用比较便宜的细同轴电缆，最后发展为使用更便宜和更灵活的双绞线。不用电缆而使用无屏蔽双绞线。每个站点需要用两对双绞线，分别用于发送和接受。

这种以太网采用星型拓扑，在星型的中心则增加了一种可靠性非常高的设备，叫做**集线器**（Hub）。

![img](https://s1.ax1x.com/2020/04/30/JHoKIA.png)

集线器的一些特点

集线器是使用电子器件来模拟实际电缆的工作，因此整个系统仍然像一个传统的仪态网那样运行，集线器使用了大规模集成电路芯片，因此这样的硬件设备的可靠性已经大大提高了。

使用集线器的以太网在逻辑上仍是一个总线网。各工作站使用的还是CSMA/CD协议，并共享逻辑上的总线。

集线器很像一个多接口的转发器，工作在物理层。

![img](https://s1.ax1x.com/2020/04/30/JHqXx1.png)

### 以太网提供的服务

以太网提供的服务是不可靠的交付，即尽最大努力的交付。当接收站收到有差错的数据帧时就丢弃此帧，其他什么也不做。差错的纠正由高层来决定。
如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一-个新的数据帧来发送。

### 以太网的信道利用率

以太网的信道被占用的情况:

争用期长度为2τ,即端到端传播时延的两倍。检测到碰撞后不发送干扰信号。
帧长为L (bit)， 数据发送速率为C (b/s)，因而帧的发送时间为L/C=T0(s)�/�=�0(�)。

一个帧从开始发送，经可能发生的碰撞后，将再重传数次，到发送成功且信道转为空闲(即再经过时间τ使得信道上无信号在传播)时为止，是发送一帧所需的平均时间。

![img](https://s1.ax1x.com/2020/04/28/JIoTRU.png)

### 以太网信道利用率：参数a

- 要提高以太网的信道利用率，就必须减小τ与T。之比。在以太网定了参数a,它是以太网单程端到端时延τ与帧的发送时间To之比:
  a=τT0�=��0
- a→0 表示一发生碰撞就立即可以检测出来，并立即停止发送，因而信道利用率很高。
- a越大，表明争用期所占的比例增大，每发生-次碰撞就浪费许多信道资源，使得信道利用率明显降低。

### 以太网信道利用率：最大值

对以太网参数的要求

- 当数据率一定时，以太网的连线的长度受到限制，否则τ的数值会太大
- 以太网的帧长不能太短，否则T的值会太小，使a值太大。

信道利用率的最大值

- 在理想化的情况下，以太网上的各站发送数据都不会产生碰撞(这显然已经不是CSMA/CD， 而是需要使用一种特殊的调度方法)，即总线一旦空闲就有某一个站立即发送数据。
- 发送一帧占用线路的时间是T0+τ�0+�， 而帧本身的发送时间是T0�0。于是我们可计算出理想情况下的极限信道利用率Smax����为:
  Smax=T0T0+τ=11+a����=�0�0+�=11+�

### MAC层的硬件地址（MAC地址）

在局域网中，**硬件地址**又称为物理地址，或**MAC地址**。
802标准所说的“地址”严格地讲应当是每一个站的“**名字**”或**标识符**。

- IEEE的**注册管理机构**RA负责向厂家分配地址字段的前三个字节（即高位24位).
- 地址字段中，后三个字节（即低位24位）由厂家自行指派，称为**扩展标识符**，必须 生产出的适配器没有重复地址
- 一个地址块可以生成224224个不同的地址。这种48位的地址称为MAC-48，它的通用名称是EUI-48
- “MAC地址”实际上就是适配器地址或适配器标识符EUI-48.

适配器检查MAC地址

适配器从网络上每收到一个MAC帧就首先用硬件检查MAC帧中的MAC地址。

- 如果是发往本站的帧则收下，然后在进行其他的处理。
- 否则就将此帧丢弃，不再进行其他处理。

“发往本站的帧”包括一下三种帧：

1. 单播（Unicast）帧（1对1）
2. 广播（broadcast）帧（1对全体)
3. 多播（multicast）帧（1对多）

帧格式

![YFaJ6x.png](https://s1.ax1x.com/2020/05/05/YFaJ6x.png)

![YFabuV.png](https://s1.ax1x.com/2020/05/05/YFabuV.png)

## 扩展以太网

### 在物理层考虑扩展

- 主机使用光纤和一对光纤调制解调器连接到集线器

![YF0ycR.png](https://s1.ax1x.com/2020/05/05/YF0ycR.png)

使用集线器扩展以太网

![YF0jUS.png](https://s1.ax1x.com/2020/05/05/YF0jUS.png)

![YFBPuq.png](https://s1.ax1x.com/2020/05/05/YFBPuq.png)

这种改变，效率不高。冲突域变大，一台计算机给其中一台发信息，所有的机器都将检测冲突。

### 在数据链路层考虑扩展

在数据链路层扩展局域网是使用网桥。
网桥工作在数据链路层，它根据MAC帧的目的地址对收到的帧进行转发。
网桥具有过滤帧的功能。当网桥收到-个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个接口
网桥有自学习功能，所以可以记录MAC地址

![YFDPRH.png](https://s1.ax1x.com/2020/05/05/YFDPRH.png)

使用网桥扩展以太网

![YFD1Qs.png](https://s1.ax1x.com/2020/05/05/YFD1Qs.png)

网桥优点

- 过滤通信量
- 扩大了物理范围
- 提高了可靠性
- 可互连不同物理层、不同MAC子层和不同速率（如10Mb/s和100Mb/s的以太网）的局域网。

网桥缺点

- 存储转发增加时延
- 在MAC子层并没有流量控制功能
- 具有不用MAC子层的网段桥接在一起时时延更大。
- 网桥只适合于用户数不太多（不超过几百个）和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。所就是所谓的广播风暴。

透明网桥

目前使用得最多的网桥是透明网桥(transparent br idge)。“透明”是指局域网上的站点并不知道所发送的帧将经过哪几个网桥,因为网桥对各站来说是看不见的。
透明网桥是一种即插即用设备，其标准是IEEE 802. 1D。

![YFsePS.png](https://s1.ax1x.com/2020/05/05/YFsePS.png)

自学习算法

按照以下自学习算法处理收到的帧和建立转发表

若从A发出的帧从接口x进入了某网桥，那么从这个接口出发沿相反方向一-定可把一一个帧传送到A。

- 网桥每收到一个帧，就记下其源地址和进入网桥的接口，作为转发表中的一个项目。
- 在建立转发表时是把帧首部中的源地址写在“地址”这一栏的下面。
- 在转发帧时，则是根据收到的帧首部中的目的地址来转发的。这时就把在“地址”栏下面已经记下的源地址当作目的地址，而把记下的进入接口当作转发接口。

自学习与帧转发

网桥收到一帧后先进行自学习。查找转发表中与收到帧的源地址有无相匹配的项目。如没有，就在转发表中增加一一个项目(源地址、进入的接口和时间)。如有，则把原有的项目进行更新。转发帧。查找转发表中与收到帧的目的地址有无相匹配的项目。

- 如没有，则通过所有其他接口(但进入网桥的接口除外)按进行转发。

- 如有，则按转发表中给出的接口进行转发。
- 若转发表中给出的接口就是该帧进入网桥的接口，则应丢弃这个帧(因为这时不需要经过网桥进行转发)。

## 虚拟局域网

### LAN和VLAN

交换机的使用使得VLAN的创建成为可能

虚拟局域网 是由一些局域网段构成的与物理位置无关的逻辑组。

- 这些网段具有某些共同的需求
- 每一个 VLAN的帧都有一个明确的标识符，指明发送这个帧的工作站是属于哪个VLAN

虚拟局域网其实只是局域网提供给用户的一种服务，而并不是一种新型局域网

## 高速以太网